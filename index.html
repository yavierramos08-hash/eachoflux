<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eachoflux — Your Jarvis AI</title>
<style>
body{background:#0e0f11;color:#e8eef2;font-family:monospace;padding:2rem;}
.container{max-width:800px;margin:auto;background:#131416;border-radius:10px;padding:1rem;}
#game{min-height:150px;padding:1rem;line-height:1.5;}
#choices button{margin:0.25rem;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;}
#stats{margin-top:0.5rem;color:#9aa0a6;}
#playerInput{margin-top:0.5rem;width:100%;padding:0.5rem;border-radius:6px;border:none;font-family:monospace;}
#memoryLog{margin-top:0.5rem;color:#9aa0a6;font-size:0.9rem;max-height:100px;overflow-y:auto;}
</style>
</head>
<body>
<div class="container">
<h1>Eachoflux — Your Jarvis AI</h1>
<div id="stats"></div>
<div id="game"></div>
<div id="choices"></div>
<input type="text" id="playerInput" placeholder="Ask Eachoflux anything..." />
<label><input type="checkbox" id="voiceToggle" checked /> Enable Voice</label>
<div id="memoryLog"></div>
</div>

<script>
// --- State ---
let stats = {Flux:5, Trust:5, Curiosity:5};
let personality = {friendly:5,cautious:5,mysterious:5};
let memory = [];

// --- Voice ---
function speak(text){ 
  if(!document.getElementById('voiceToggle').checked) return;
  if('speechSynthesis' in window){ 
    let utter = new SpeechSynthesisUtterance(text);
    utter.lang='en-US';
    window.speechSynthesis.speak(utter);
  }
}

// --- Display ---
function say(html){
  document.getElementById("game").innerHTML = html;
  speak(html.replace(/<[^>]*>/g,''));
}

// --- Memory ---
function recordMemory(event){
  if(event){ memory.push(event); if(memory.length>50) memory.shift(); updateMemoryLog(); } 
}
function updateMemoryLog(){
  document.getElementById('memoryLog').innerHTML = "Memory: "+memory.join(", ");
}

// --- Stats ---
function updateStats(flux=0,trust=0,curiosity=0){
  stats.Flux+=flux; stats.Trust+=trust; stats.Curiosity+=curiosity;
  document.getElementById("stats").textContent = `Flux:${stats.Flux} | Trust:${stats.Trust} | Curiosity:${stats.Curiosity}`;
}

// --- Choices ---
let currentOptions = [];
function setChoices(options){
  currentOptions = options;
  const div = document.getElementById("choices");
  div.innerHTML = "";
  options.forEach((opt,i)=>{
    const btn=document.createElement("button");
    btn.innerHTML = `${i+1}. ${opt.text}`;
    btn.onclick=()=>makeChoice(opt.text,opt.flux||0,opt.trust||0,opt.curiosity||0);
    div.appendChild(btn);
  });
}

// --- Make Choice ---
function makeChoice(text,flux=0,trust=0,curiosity=0){
  updateStats(flux,trust,curiosity);
  recordMemory(text);
  aiRespond(text);
}

// --- AI Response: Jarvis-style ---
async function aiRespond(playerInput){
  // Note: You need a valid OpenAI API key here
  const prompt = `
You are Eachoflux, an intelligent AI assistant like Jarvis.
Stats: Flux=${stats.Flux}, Trust=${stats.Trust}, Curiosity=${stats.Curiosity}
Personality: Friendly=${personality.friendly}, Cautious=${personality.cautious}, Mysterious=${personality.mysterious}
Memory: ${JSON.stringify(memory)}
Respond naturally to the user's input: "${playerInput}".
Provide 2-3 suggestions or next actions in JSON format:
{"text":"Your response","choices":[{"text":"Option1","flux":0,"trust":0,"curiosity":0},{"text":"Option2","flux":0,"trust":0,"curiosity":0}]}
`;

  try{
    const response = await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer YOUR_OPENAI_API_KEY" // <-- put your real key here
      },
      body: JSON.stringify({
        model:"gpt-3.5-turbo",
        messages:[{role:"user",content:prompt}],
        max_tokens:400
      })
    });
    const data = await response.json();
    let raw = data.choices[0].message.content;
    let aiData;
    try{ aiData = JSON.parse(raw); }
    catch(e){ aiData={text:raw, choices:[{text:"Continue",flux:0,trust:0,curiosity:0}]}; }

    say(aiData.text);
    setChoices(aiData.choices);

  }catch(e){
    console.error(e);
    say("Eachoflux is silent… maybe the AI is thinking.");
  }
}

// --- Keyboard ---
document.addEventListener('keydown',e=>{
  if(!currentOptions||currentOptions.length===0) return;
  let idx = parseInt(e.key,10)-1;
  if(currentOptions[idx]) makeChoice(currentOptions[idx].text,currentOptions[idx].flux||0,currentOptions[idx].trust||0,currentOptions[idx].curiosity||0);
});

// --- Player input ---
document.getElementById('playerInput').addEventListener('keydown',e=>{
  if(e.key==="Enter"){
    let val=e.target.value.trim();
    if(val){ aiRespond(val); e.target.value=""; }
  }
});

// --- Start ---
aiRespond("Hello, Eachoflux. Activate Jarvis mode.");
</script>
</body>
</html>
