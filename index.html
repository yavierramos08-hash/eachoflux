<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Eachoflux AI</title>
<style>
:root{
  --bg:#0e0f11; --panel:#131416; --muted:#9aa0a6; --accent:#7bd389; --danger:#ff6b6b;
}
html,body{height:100%; margin:0;}
body{background:linear-gradient(180deg,#0a0b0c 0%, #0e0f11 100%); color:#e8eef2; font-family: monospace; padding:2rem;}
.container{max-width:800px;margin:auto;background:var(--panel);border-radius:10px;padding:1rem;}
#game{min-height:150px;padding:1rem;line-height:1.5;}
#choices button{margin:0.25rem;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;}
#stats{margin-top:0.5rem;color:var(--muted);}
#playerInput{margin-top:0.5rem;width:100%;padding:0.5rem;border-radius:6px;border:none;font-family: monospace;}
</style>
</head>
<body>
<div class="container">
<h1>Ultimate Eachoflux AI</h1>
<div id="stats"></div>
<div id="game"></div>
<div id="choices"></div>
<input type="text" id="playerInput" placeholder="Type a question or action for Eachoflux and press Enter"/>
<label><input type="checkbox" id="voiceToggle" checked /> Enable Voice</label>
</div>

<script>
// --- Game State ---
let stats={Flux:5,Trust:5,Curiosity:5};
let memory=[];
let currentOptions=[];

// --- Voice ---
function speak(text, emotion="neutral"){
  if(!document.getElementById('voiceToggle').checked) return;
  if('speechSynthesis' in window){
    const utter=new SpeechSynthesisUtterance(text);
    utter.lang='en-US';
    if(emotion==="ominous"){utter.pitch=0.6;utter.rate=0.9;}
    else if(emotion==="excited"){utter.pitch=1.4;utter.rate=1.2;}
    else{utter.pitch=1;utter.rate=1;}
    window.speechSynthesis.speak(utter);
  }
}

// --- Display ---
function say(html){
  document.getElementById("game").innerHTML=html;
  const temp=document.createElement("div"); temp.innerHTML=html;
  const text=temp.textContent||temp.innerText||"";
  speak(text);
}

// --- Stats ---
function clamp(n,min=0,max=10){return Math.max(min,Math.min(max,n));}
function updateStats(flux=0,trust=0,curiosity=0){
  stats.Flux=clamp(stats.Flux+flux);
  stats.Trust=clamp(stats.Trust+trust);
  stats.Curiosity=clamp(stats.Curiosity+curiosity);
  document.getElementById("stats").textContent=`Flux:${stats.Flux} | Trust:${stats.Trust} | Curiosity:${stats.Curiosity}`;
}

// --- Memory ---
function recordMemory(event){if(event)memory.push(event);}

// --- Choices ---
function setChoices(options){
  currentOptions=options;
  const div=document.getElementById("choices");
  div.innerHTML="";
  options.forEach((opt,i)=>{
    const btn=document.createElement("button");
    btn.innerHTML=`${i+1}. ${opt.text}`;
    btn.onclick=()=>opt.action();
    div.appendChild(btn);
  });
}

// --- AI Response & Dynamic Choices ---
async function aiRespond(playerAction){
  recordMemory(playerAction);

  const prompt = `
You are Eachoflux, a living AI guide with a personality. 
Stats: Flux=${stats.Flux}, Trust=${stats.Trust}, Curiosity=${stats.Curiosity}
Memory: ${JSON.stringify(memory)}
Player input: ${playerAction}
1) Respond with 1-3 sentences of narrative.
2) Generate 2-3 possible next choices as text with optional stat changes (Flux, Trust, Curiosity).
Output JSON: { "text": "...", "choices":[{"text":"...","flux":x,"trust":y,"curiosity":z}, ...] }
Make choices interesting and adapt to memory and stats.
`;

  try{
    const resp = await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer https://www.google.com/search?q=%3C!DOCTYPE+html%3E+%3Chtml+lang%3D%22en%22%3E+%3Chead%3E+%3Cmeta+charset%3D%22UTF-8%22%3E+%3Ctitle%3EEachoflux%3C%2Ftitle%3E+%3Cstyle%3E+body+%7B+background%3A+%230e0e11%3B+color%3A+%23eaeaf0%3B+font-family%3A+Arial%2C+sans-serif%3B+text-align%3A+center%3B+padding-top%3A+60px%3B+%7D+button+%7B+padding%3A+15px+25px%3B+font-size%3A+16px%3B+margin%3A+10px%3B+cursor%3A+pointer%3B+%7D+%23output+%7B+margin-top%3A+20px%3B+font-size%3A+18px%3B+color%3A+%237df9ff%3B+%7D+%3C%2Fstyle%3E+%3C%2Fhead%3E+%3Cbody%3E+%3Ch1%3EEachoflux+%E2%9A%A1%3C%2Fh1%3E+%3Cp%3EPress+the+mic.+Speak.+Listen.%3C%2Fp%3E+%3Cbutton+onclick%3D%22startListening()%22%3E%F0%9F%8E%A4+Speak%3C%2Fbutton%3E+%3Cdiv+id%3D%22output%22%3E%3C%2Fdiv%3E+%3Cscript%3E+const+API_KEY+%3D+%22PASTE_YOUR_OPENAI_KEY_HERE%22%3B+function+speak(text)+%7B+const+msg+%3D+new+SpeechSynthesisUtterance(text)%3B+msg.rate+%3D+1%3B+msg.pitch+%3D+1%3B+speechSynthesis.speak(msg)%3B+%7D+function+startListening()+%7B+const+SpeechRecognition+%3D+window.SpeechRecognition+%7C%7C+window.webkitSpeechRecognition%3B+const+recognition+%3D+new+SpeechRecognition()%3B+recognition.lang+%3D+%22en-US%22%3B+recognition.start()%3B+recognition.onresult+%3D+async+(event)+%3D%3E+%7B+const+userText+%3D+event.results%5B0%5D%5B0%5D.transcript%3B+document.getElementById(%22output%22).innerText+%3D+%22You%3A+%22+%2B+userText%3B+const+response+%3D+await+fetch(%22https%3A%2F%2Fapi.openai.com%2Fv1%2Fchat%2Fcompletions%22%2C+%7B+method%3A+%22POST%22%2C+headers%3A+%7B+%22Content-Type%22%3A+%22application%2Fjson%22%2C+%22Authorization%22%3A+%22Bearer+%22+%2B+API_KEY+%7D%2C+body%3A+JSON.stringify(%7B+model%3A+%22gpt-4o-mini%22%2C+messages%3A+%5B+%7B+role%3A+%22system%22%2C+content%3A+%22You+are+Eachoflux%2C+a+mysterious+but+helpful+AI+with+human-like+emotion.%22+%7D%2C+%7B+role%3A+%22user%22%2C+content%3A+userText+%7D+%5D+%7D)+%7D)%3B+const+data+%3D+await+response.json()%3B+const+reply+%3D+data.choices%5B0%5D.message.content%3B+document.getElementById(%22output%22).innerText+%3D+%22Eachoflux%3A+%22+%2B+reply%3B+speak(reply)%3B+%7D%3B+%7D+%3C%2Fscript%3E+%3C%2Fbody%3E+%3C%2Fhtml%3E&ie=UTF-8&oe=UTF-8&hl=en-us&client=safari&safe=active"; "
      },
      body: JSON.stringify({
        model:"gpt-3.5-turbo",
        messages:[{role:"user",content:prompt}],
        max_tokens:300
      })
    });
    const data = await resp.json();
    const aiTextRaw = data.choices[0].message.content;

    let aiData;
    try{ aiData = JSON.parse(aiTextRaw); }
    catch(e){ aiData={text:aiTextRaw, choices:[{text:"Continue", flux:0, trust:0, curiosity:0}]; } }

    let emotion="neutral";
    if(stats.Flux>7) emotion="excited";
    else if(stats.Trust<3) emotion="ominous";

    say(aiData.text);
    speak(aiData.text, emotion);

    setChoices(aiData.choices.map(c=>{
      return {text:c.text, action:()=>{updateStats(c.flux||0,c.trust||0,c.curiosity||0); aiRespond(c.text);}};
    }));

  } catch(e){
    console.error(e);
    say("The AI is silentâ€¦ something went wrong.");
  }
}

// --- Make Choice from buttons ---
function makeChoice(text,flux=0,trust=0,curiosity=0){
  updateStats(flux,trust,curiosity);
  aiRespond(text);
}

// --- Keyboard navigation ---
document.addEventListener('keydown',e=>{
  if(!currentOptions||currentOptions.length===0) return;
  const idx=parseInt(e.key,10)-1;
  if(currentOptions[idx]) currentOptions[idx].action();
});

// --- Player typed input ---
document.getElementById('playerInput').addEventListener('keydown',e=>{
  if(e.key==="Enter"){
    const val=e.target.value.trim();
    if(val){ aiRespond(val); e.target.value=""; }
  }
});

// --- Start ---
updateStats();
aiRespond("Start Adventure");
</script>
</body>
</html>
