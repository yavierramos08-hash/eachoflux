<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Eachoflux AI Adventure — a short interactive micro-game."/>
  <title>Eachoflux AI Adventure</title>
  <style>
    :root{
      --bg:#0e0f11;
      --panel:#131416;
      --muted:#9aa0a6;
      --accent:#7bd389;
      --danger:#ff6b6b;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%; margin:0;}
    body {
      background: radial-gradient(1000px 400px at 10% 10%, rgba(123,211,137,0.06), transparent),
                  linear-gradient(180deg,#0a0b0c 0%, #0e0f11 100%);
      color: #e8eef2;
      font-family: "Courier New", ui-monospace, SFMono-Regular, Menlo, monospace;
      padding: 2rem;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width:820px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:10px;
      padding:1.25rem;
      box-shadow: 0 6px 28px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.03);
    }
    header{display:flex;align-items:center;justify-content:space-between;gap:1rem}
    h1{margin:0;font-size:1.25rem}
    .meta{color:var(--muted); font-size:0.9rem}
    main{margin-top:1rem}
    #game{
      min-height:120px;
      padding:1rem;
      background:var(--panel);
      border-radius:8px;
      line-height:1.6;
      color:#e9f6ea;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }
    #stats{
      margin-top:0.75rem;
      color:var(--muted);
    }
    #controls{margin-top:0.75rem; display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap}
    .btn{
      background:var(--glass);
      color:inherit;
      border:1px solid rgba(255,255,255,0.04);
      padding:0.45rem 0.75rem;
      border-radius:6px;
      cursor:pointer;
      font-size:0.95rem;
    }
    .btn.primary{background:linear-gradient(90deg,var(--accent), rgba(123,211,137,0.12)); border:none; color:#08110a}
    .btn.danger{background:transparent; border:1px solid rgba(255,107,107,0.14); color:var(--danger)}
    #choices{margin-top:1rem; display:flex; gap:0.5rem; flex-wrap:wrap}
    #choices button{
      padding:0.75rem 1.05rem;
      background:rgba(255,255,255,0.02);
      color:inherit;
      border:1px solid rgba(255,255,255,0.04);
      border-radius:8px;
      cursor:pointer;
      min-width:140px;
      text-align:center;
    }
    #choices button:focus{outline:2px solid rgba(123,211,137,0.18)}
    .hint{color:var(--muted); font-size:0.9rem; margin-left:0.5rem}
    footer{margin-top:1rem; color:var(--muted); font-size:0.85rem}
    @media (max-width:520px){
      #choices button{min-width:unset; flex:1 1 100%}
      header{flex-direction:column; align-items:flex-start}
    }
  </style>
</head>
<body>
  <div class="container" role="application" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Eachoflux AI Adventure</h1>
        <div class="meta">A tiny interactive experience — keyboard: 1, 2, 3 to pick options</div>
      </div>
      <div id="stats" aria-live="polite"></div>
    </header>

    <main>
      <div id="game" aria-live="polite"></div>

      <div id="choices" role="group" aria-label="Choices"></div>

      <div id="controls">
        <button class="btn primary" id="saveBtn">Save</button>
        <button class="btn" id="loadBtn">Load</button>
        <button class="btn danger" id="resetBtn">Reset</button>
        <label class="hint"><input type="checkbox" id="autoSave" /> Auto-save</label>
        <div class="hint" id="message"></div>
      </div>
    </main>

    <footer>
      Tip: use the number keys 1/2/3 to select a choice quickly. Memory is saved to localStorage when you click Save or if Auto-save is enabled.
    </footer>
  </div>

  <script>
  // --- Game State ---
  const STORAGE_KEY = 'eachoflux_state_v1';
  let stats = { Flux: 5, Trust: 5, Curiosity: 5 };
  let memory = [];
  let currentOptions = []; // used for keyboard navigation

  // --- Helper Functions ---
  function clamp(n, min=0, max=10){ return Math.max(min, Math.min(max, n)); }

  function updateStats(flux=0, trust=0, curiosity=0){
    stats.Flux = clamp(stats.Flux + flux);
    stats.Trust = clamp(stats.Trust + trust);
    stats.Curiosity = clamp(stats.Curiosity + curiosity);
    const s = `Flux: ${stats.Flux} | Trust: ${stats.Trust} | Curiosity: ${stats.Curiosity}`;
    document.getElementById("stats").textContent = s;
    if(document.getElementById('autoSave').checked) saveState();
  }

  function recordMemory(event){
    if(!event) return;
    memory.push(event);
    if(memory.length > 30) memory.shift(); // keep memory bounded
    if(document.getElementById('autoSave').checked) saveState();
  }

  function say(html){
    document.getElementById("game").innerHTML = html;
  }

  function showMessage(msg, ms = 1800){
    const el = document.getElementById('message');
    el.textContent = msg;
    if(ms>0) setTimeout(()=>{ if(el.textContent === msg) el.textContent = ''; }, ms);
  }

  // --- Persistence ---
  function getState(){
    return { stats, memory };
  }
  function saveState(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(getState()));
      showMessage('Saved ✓');
    }catch(e){
      showMessage('Save failed', 2000);
      console.error(e);
    }
  }
  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      const parsed = JSON.parse(raw);
      if(parsed.stats) stats = parsed.stats;
      if(Array.isArray(parsed.memory)) memory = parsed.memory;
      showMessage('Loaded ✓');
      return true;
    }catch(e){
      console.error(e);
      showMessage('Load failed', 2000);
      return false;
    }
  }
  function clearState(){
    localStorage.removeItem(STORAGE_KEY);
    stats = { Flux:5, Trust:5, Curiosity:5 };
    memory = [];
    showMessage('Reset ✓');
  }

  // --- Scenes ---
  function sceneHallway(){
    say("Three paths lie before you… choose by the tremor in your heart.");
    setChoices([
      {text:"Circle (Follow intuition)", action:()=>{ updateStats(1,1,0); recordMemory("Chose Circle"); sceneCircle(); }},
      {text:"Triangle (Use logic)", action:()=>{ updateStats(-1,0,0); recordMemory("Chose Triangle"); sceneTriangle(); }},
      {text:"Spiral (Hesitate)", action:()=>{ updateStats(-1,-1,0); recordMemory("Chose Spiral"); sceneSpiral(); }}
    ]);
  }

  function sceneCircle(){
    say("You enter a golden hallway. Three runes float: Key, Flame, Wave.");
    setChoices([
      {text:"Key", action:()=>{ updateStats(2,1,0); recordMemory("Chose Key rune"); sceneCrossroads(); }},
      {text:"Flame", action:()=>{ updateStats(1,0,0); recordMemory("Chose Flame rune"); sceneCrossroads(); }},
      {text:"Wave", action:()=>{ updateStats(1,-1,0); recordMemory("Chose Wave rune"); sceneCrossroads(); }}
    ]);
  }

  function sceneTriangle(){
    say("Mirrored walls reflect your hesitation. Riddle: 'I speak without a voice… What am I?'" );
    setChoices([
      {text:"Echo", action:()=>{ updateStats(1,1,0); recordMemory("Solved Echo riddle"); sceneCrossroads(); }},
      {text:"Ignore", action:()=>{ updateStats(-1,-1,0); recordMemory("Ignored riddle"); sceneCrossroads(); }},
      {text:"Investigate mirrors", action:()=>{ updateStats(0,2,1); recordMemory("Investigated mirrors"); sceneCrossroads(); }}
    ]);
  }

  function sceneSpiral(){
    say("Shadows deepen and whisper secrets. Flux pulses unpredictably.");
    recordMemory("Entered Spiral");
    setTimeout(sceneCrossroads, 800);
  }

  function sceneCrossroads(){
    say("The corridor splits again… choose your path.");
    setChoices([
      {text:"Left (Shadow)", action:()=>{ updateStats(-1,-1,0); recordMemory("Shadow path"); sceneShadow(); }},
      {text:"Right (Light)", action:()=>{ updateStats(2,1,0); recordMemory("Light path"); sceneLight(); }},
      {text:"Forward (Unknown)", action:()=>{ updateStats(0,0,2); recordMemory("Unknown path"); sceneUnknown(); }}
    ]);
  }

  function sceneShadow(){
    say("Riddle: 'Taken from a mine, shut in wood, used by artists. What am I?'" );
    setChoices([
      {text:"Pencil", action:()=>{ updateStats(1,2,0); recordMemory("Answered Pencil"); sceneEnd(); }},
      {text:"Coal", action:()=>{ updateStats(-1,-1,0); recordMemory("Answered Coal"); sceneEnd(); }},
      {text:"Brush", action:()=>{ updateStats(-1,-1,0); recordMemory("Answered Brush"); sceneEnd(); }}
    ]);
  }

  function sceneLight(){
    say("A glowing door appears.");
    setChoices([
      {text:"Open it", action:()=>{ updateStats(2,1,0); recordMemory("Opened door"); sceneEnd(); }},
      {text:"Inspect sigil", action:()=>{ updateStats(0,0,2); recordMemory("Inspected sigil"); sceneEnd(); }},
      {text:"Step back", action:()=>{ updateStats(0,-1,0); recordMemory("Stepped back"); sceneEnd(); }}
    ]);
  }

  function sceneUnknown(){
    const memStr = memory.length>0 ? "You remember past choices: "+memory.join(", ") : "You have no memory here…";
    say("Time feels unstable. " + memStr);
    updateStats(1,0,0);
    setTimeout(sceneEnd, 800);
  }

  function sceneEnd(){
    const mem = memory.length ? memory.join(", ") : "—";
    say(`Your journey concludes…<br><br><strong>Final Stats</strong><br>Flux: ${stats.Flux} | Trust: ${stats.Trust} | Curiosity: ${stats.Curiosity}<br><br><strong>Memory</strong>: ${mem}`);
    setChoices([
      {text:"Restart", action:()=>{ stats={Flux:5,Trust:5,Curiosity:5}; memory=[]; saveIfAuto(); sceneHallway(); }},
      {text:"Save & Exit", action:()=>{ saveState(); say("Saved. Come back soon."); setChoices([]); }},
      {text:"Clear Save", action:()=>{ if(confirm("Clear saved progress?")){ clearState(); say("Saved progress cleared."); setChoices([{text:"Start New", action:()=>{ sceneHallway(); }}]); } }}
    ]);
  }

  // --- Choice Buttons & Keyboard ---
  function setChoices(options){
    currentOptions = options;
    const div = document.getElementById("choices");
    div.innerHTML = "";
    if(!options || options.length === 0) return;
    options.forEach((opt, i)=>{
      const btn = document.createElement("button");
      btn.innerHTML = `<strong>${i+1}.</strong> ${opt.text}`;
      btn.type = "button";
      btn.tabIndex = 0;
      btn.onclick = ()=> { opt.action(); };
      btn.setAttribute('aria-label', `Choice ${i+1}: ${opt.text}`);
      div.appendChild(btn);
    });
  }

  function handleKey(e){
    const key = e.key;
    if(!currentOptions || currentOptions.length===0) return;
    if(['1','2','3'].includes(key)){
      const idx = parseInt(key,10)-1;
      if(currentOptions[idx]) {
        currentOptions[idx].action();
      }
    }
    if(key === 's' && (e.ctrlKey || e.metaKey) ){
      e.preventDefault();
      saveState();
    }
    if(key === 'r' && (e.ctrlKey || e.metaKey) ){
      e.preventDefault();
      if(confirm('Restart game?')) { stats={Flux:5,Trust:5,Curiosity:5}; memory=[]; saveIfAuto(); sceneHallway(); }
    }
  }
  document.addEventListener('keydown', handleKey);

  // --- UI Controls wiring ---
  document.getElementById('saveBtn').addEventListener('click', saveState);
  document.getElementById('loadBtn').addEventListener('click', ()=>{
    const ok = loadState();
    if(ok){ updateStats(); sceneHallway(); } else showMessage('No saved data', 1600);
  });
  document.getElementById('resetBtn').addEventListener('click', ()=>{
    if(confirm('Reset game and clear saved progress?')){
      clearState();
      updateStats();
      sceneHallway();
    }
  });

  function saveIfAuto(){ if(document.getElementById('autoSave').checked) saveState(); }

  // --- Start Game (attempt load) ---
  (function init(){
    const loaded = loadState();
    updateStats();
    if(loaded){
      // if loaded, show the last known scene as a short resume message then go to hallway
      say("Welcome back. Your prior progress was loaded. Resume your path.");
      setTimeout(sceneHallway, 900);
    } else {
      sceneHallway();
    }
  })();

  </script>
</body>
</html>